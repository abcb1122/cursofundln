<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠a Definitiva: Tu Primer Nodo Lightning en la Nube</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f9f9f9;
        }
        h1, h2, h3 {
            color: #d97d0d; /* Naranja Bitcoin */
            border-bottom: 2px solid #ddd;
            padding-bottom: 5px;
        }
        h1 {
            text-align: center;
            border-bottom: 4px solid #d97d0d;
        }
        code {
            background-color: #eee;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: "Courier New", Courier, monospace;
            font-size: 0.95em;
            word-wrap: break-word;
        }
        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        pre code {
            background-color: transparent;
            padding: 0;
        }
        blockquote {
            border-left: 4px solid #d97d0d;
            padding-left: 15px;
            margin: 20px 0;
            font-style: italic;
            color: #555;
            background-color: #fff8e1;
        }
        .emoji {
            font-size: 1.2em;
            vertical-align: middle;
        }
        .importante {
            color: #c0392b;
            font-weight: bold;
        }
        .leccion {
            background-color: #e8f4fd;
            border: 1px solid #a1c9e8;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <h1><span class="emoji">üöÄ</span> Gu√≠a Definitiva: Tu Primer Nodo Lightning en la Nube <span class="emoji">‚ö°Ô∏è</span></h1>
    <p><em>Una gu√≠a de principiante a profesional, forjada en la batalla contra los errores y la curiosidad. Por Ariel y su copiloto de IA.</em></p>

    <h2>Introducci√≥n: ¬øQu√© Vamos a Construir?</h2>
    <p>Hola, futuro operador de nodo. Si tienes 15 a√±os o m√°s y no sabes nada de programaci√≥n pero tienes una curiosidad gigante, esta gu√≠a es para ti. Juntos, vamos a montar desde cero un sistema robusto, seguro y profesional en la nube.</p>
    <p>Al final de esta gu√≠a, tendr√°s:</p>
    <ul>
        <li>Una <strong>m√°quina virtual (VM)</strong> propia en los servidores de Amazon (AWS).</li>
        <li>Un <strong>nodo de Bitcoin Core (`bitcoind`)</strong> 100% sincronizado en la red de pruebas <strong>Signet</strong>.</li>
        <li>Un <strong>nodo de Lightning Network (LND)</strong> funcional y listo para operar.</li>
        <li>Un <strong>t√∫nel privado y seguro (Tailscale)</strong> para acceder a tu nodo desde cualquier lugar.</li>
        <li>Ambos nodos configurados como <strong>servicios autom√°ticos y resilientes</strong> que arrancan solos.</li>
        <li>Y lo m√°s importante: **satoshis de prueba en ambas carteras** para demostrar que todo funciona.</li>
    </ul>
    <blockquote>
        <span class="emoji">üß†</span> <strong>Nuestra Filosof√≠a:</strong> Medir dos veces, cortar una. No correremos, aprenderemos. Entenderemos el "porqu√©" de cada paso y construiremos algo de lo que estar orgullosos.
    </blockquote>

    <h2>Fase 1: Construyendo Nuestro Servidor en la Nube (AWS)</h2>
    <p>Primero, necesitamos nuestro "terreno" en la nube. Usaremos la capa gratuita de Amazon Web Services (AWS).</p>

    <h3>Paso 1: Crear una cuenta en AWS</h3>
    <p>Ve a <a href="https://aws.amazon.com/free/" target="_blank">https://aws.amazon.com/free/</a> y crea una cuenta gratuita. Necesitar√°s una tarjeta de cr√©dito/d√©bito para la verificaci√≥n (no te cobrar√°n si seguimos los pasos de la capa gratuita).</p>

    <h3>Paso 2: Lanzar la M√°quina Virtual (Instancia EC2)</h3>
    <p>Una vez dentro de la consola de AWS, sigue esta lista de chequeo para crear tu m√°quina:</p>
    <ol>
        <li>Haz clic en <strong>"Launch instance"</strong>.</li>
        <li><strong>Nombre:</strong> Ponle un nombre, como <code>nodo-lightning-v2</code>.</li>
        <li><strong>Sistema Operativo (AMI):</strong> Elige <strong>Ubuntu</strong> (la versi√≥n que diga "Free tier eligible", por ejemplo Ubuntu 24.04).</li>
        <li><strong>Arquitectura:</strong> Deja la opci√≥n <strong>64-bit (x86)</strong>.</li>
        <li><strong>Tipo de Instancia:</strong> Elige <strong><code>t2.micro</code></strong> (tambi√©n debe decir "Free tier eligible").</li>
        <li><strong>Llave de Acceso (Key Pair):</strong> ¬°Paso cr√≠tico! Haz clic en <strong>"Create new key pair"</strong>. Dale un nombre (ej: <code>llave-nodo-v2</code>), aseg√∫rate de que el formato sea <code>.pem</code> y guarda el archivo que se descarga en un lugar s√∫per seguro de tu computadora. <strong class="importante">Si pierdes esta llave, pierdes el acceso a tu servidor.</strong></li>
        <li><strong>Configuraci√≥n de Red:</strong> Marca la casilla <strong>"Allow SSH traffic from"</strong>.</li>
        <li><strong>Almacenamiento:</strong> Aumenta el tama√±o a <strong>50 GiB</strong>. Esto nos da espacio de sobra para el futuro.</li>
        <li>Haz clic en <strong>"Launch instance"</strong>.</li>
    </ol>
    <p>Espera unos minutos hasta que los "Status checks" de tu instancia muestren 2/2 comprobaciones superadas (los dos checks en verde).</p>
    
    <h3>Paso 3: Primera Conexi√≥n (SSH)</h3>
    <p>Con la m√°quina lista, necesitamos entrar. Copia la <strong>"Public IPv4 address"</strong> de tu instancia desde la consola de AWS.</p>
    <p>En tu Mac/Linux, abre la <strong>Terminal</strong>. Primero, moveremos la llave que descargaste a un lugar seguro y le daremos los permisos correctos. Reemplaza <code>/ruta/a/tu/llave-nodo-v2.pem</code> con la ruta real donde guardaste el archivo.</p>
    <pre><code># Mover la llave a la carpeta segura de SSH (cre√°ndola si no existe)
mkdir -p ~/.ssh
mv /ruta/a/tu/llave-nodo-v2.pem ~/.ssh/

# Darle permisos de "s√∫per secreto" (solo t√∫ puedes leerla)
chmod 400 ~/.ssh/llave-nodo-v2.pem</code></pre>
    <p>Ahora, con√©ctate usando la IP p√∫blica y el nombre de tu llave:</p>
    <pre><code># Reemplaza la IP y el nombre de la llave si es diferente
ssh -i ~/.ssh/llave-nodo-v2.pem ubuntu@TU_IP_PUBLICA</code></pre>
    <p>La primera vez te preguntar√° si conf√≠as en el servidor. Escribe <code>yes</code> y presiona Enter. ¬°Felicitaciones, est√°s dentro de tu servidor!</p>

    <h2>Fase 2: "Blindando" el Servidor (Puesta a Punto Profesional)</h2>
    <p>Antes de instalar nada, haremos nuestro servidor robusto y seguro.</p>

    <h3>Paso 1: Actualizar el Sistema</h3>
    <p>Lo primero en un servidor nuevo es actualizar todo su software.</p>
    <pre><code>sudo apt update && sudo apt upgrade -y</code></pre>

    <h3>Paso 2: Crear "Memoria de Emergencia" (Swap File)</h3>
    <div class="leccion">
        <span class="emoji">üí°</span> <strong>Lecci√≥n Aprendida:</strong> Las m√°quinas peque√±as (como la nuestra `t2.micro` con 1GB de RAM) pueden colapsar con tareas pesadas. Un "archivo de swap" usa el disco duro como RAM de emergencia para evitarlo.
    </div>
    <p>Crea y activa un archivo swap de 2GB con este s√∫per-comando:</p>
    <pre><code>sudo fallocate -l 2G /swapfile && sudo chmod 600 /swapfile && sudo mkswap /swapfile && sudo swapon /swapfile && echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab</code></pre>
    <p>Verifica que funciona con <code>free -h</code>. Deber√≠as ver una fila "Swap" con "2.0G".</p>

    <h3>Paso 3: Instalar el "Pasadizo Secreto" (Tailscale)</h3>
    <p>Para no exponer nuestro servidor a todo internet, crearemos una red privada con Tailscale.</p>
    <pre><code># Instalar la herramienta 'curl' y luego Tailscale
sudo apt install curl -y && curl -fsSL https://tailscale.com/install.sh | sh

# Encender Tailscale y conectar a tu cuenta
sudo tailscale up</code></pre>
    <p>Este √∫ltimo comando te dar√° un enlace. C√≥pialo y p√©galo en tu navegador para autorizar la nueva m√°quina en tu red de Tailscale.</p>

    <h3>Paso 4: Sellar la Puerta P√∫blica</h3>
    <p>Una vez que Tailscale est√© funcionando, volvemos a la <strong>consola de AWS</strong>. Ve a los detalles de tu instancia -> Pesta√±a "Security" -> Clic en el "Security Group" -> "Edit inbound rules" -> <strong>Borra</strong> la regla que permite tr√°fico en el puerto 22 desde `0.0.0.0/0` -> "Save rules".</p>
    <p class="importante"><span class="emoji">‚ö†Ô∏è</span> ¬°A partir de ahora, tu servidor es invisible! Solo podr√°s conectarte por SSH usando la IP de Tailscale de tu VM (la puedes ver con `tailscale ip -4`).</p>

    <h2>Fase 3: Instalando los Motores (Bitcoin y LND)</h2>
    <p>Con el servidor seguro y robusto, es hora de instalar nuestro software.</p>

    <h3>Paso 1: Instalar Bitcoin Core (M√©todo Binario)</h3>
    <div class="leccion">
        <span class="emoji">üí°</span> <strong>Lecci√≥n Aprendida:</strong> Descargar el programa ya "armado" (el binario) es m√°s r√°pido y seguro para nuestra m√°quina que intentar compilarlo.
    </div>
    <p>Averig√ºemos la √∫ltima versi√≥n estable con nuestro truco de detective:</p>
    <pre><code>git ls-remote --tags https://github.com/bitcoin/bitcoin.git | grep -o 'v[0-9]\+.[0-9]\+' | sort -V | tail -n 1</code></pre>
    <p>Usa la versi√≥n que te d√© como resultado en el siguiente s√∫per-comando (aqu√≠ usamos 29.0 como ejemplo):</p>
    <pre><code># Reemplaza 29.0 si encontraste una versi√≥n m√°s nueva
BITCOIN_VERSION=29.0 && \
wget https://bitcoincore.org/bin/bitcoin-core-${BITCOIN_VERSION}/bitcoin-${BITCOIN_VERSION}-x86_64-linux-gnu.tar.gz && \
wget https://bitcoincore.org/bin/bitcoin-core-${BITCOIN_VERSION}/SHA256SUMS && \
grep "bitcoin-${BITCOIN_VERSION}-x86_64-linux-gnu.tar.gz" SHA256SUMS | sha256sum -c - && \
tar -xvf bitcoin-${BITCOIN_VERSION}-x86_64-linux-gnu.tar.gz && \
sudo install -m 0755 -o root -g root -t /usr/local/bin bitcoin-${BITCOIN_VERSION}/bin/* && \
rm -rf bitcoin* SHA256SUMS</code></pre>
    <p>Busca la l√≠nea de respuesta <code>...: OK</code> para confirmar que la descarga fue segura.</p>

    <h3>Paso 2: Configurar y Automatizar Bitcoin Core</h3>
    <p>Le daremos sus instrucciones y lo convertiremos en un servicio que arranque solo.</p>
    <pre><code># Crear la carpeta de configuraci√≥n
mkdir ~/.bitcoin

# Crear y editar el archivo de configuraci√≥n
nano ~/.bitcoin/bitcoin.conf</code></pre>
    <p>Pega esto dentro de `nano`:</p>
    <pre><code># Usar la red de pruebas Signet
signet=1
server=1
txindex=1

# Credenciales para que LND pueda hablarle
rpcuser=usuario_signet
rpcpassword=contrase√±a_secreta_para_signet_54321

# Canales de notificaci√≥n
zmqpubrawblock=tcp://127.0.0.1:28332
zmqpubrawtx=tcp://127.0.0.1:28333</code></pre>
    <p>Guarda y sal. Ahora, crea el archivo de servicio para que sea autom√°tico:</p>
    <pre><code>sudo nano /etc/systemd/system/bitcoind.service</code></pre>
    <p>Pega esto dentro:</p>
    <pre><code>[Unit]
Description=Bitcoin daemon
After=network.target

[Service]
ExecStart=/usr/local/bin/bitcoind -daemon -conf=/home/ubuntu/.bitcoin/bitcoin.conf -pid=/home/ubuntu/.bitcoin/bitcoind.pid
User=ubuntu
Group=ubuntu
Type=forking
PIDFile=/home/ubuntu/.bitcoin/bitcoind.pid
Restart=on-failure
RestartSec=20

[Install]
WantedBy=multi-user.target</code></pre>
    <p>Guarda y sal. Finalmente, activa y arranca el servicio:</p>
    <pre><code>sudo systemctl daemon-reload
sudo systemctl enable bitcoind.service
sudo systemctl start bitcoind</code></pre>
    <p>Verifica que est√° corriendo con <code>sudo systemctl status bitcoind</code>. ¬°Busca el punto verde ‚óè!</p>

    <h3>Paso 3: Instalar LND (M√©todo Binario)</h3>
    <p>Haremos lo mismo para LND. Buscamos la √∫ltima versi√≥n estable (no `rc` o `alpha` si es posible):</p>
    <pre><code>git ls-remote --tags https://github.com/lightningnetwork/lnd.git | grep -o 'v[0-9]\+.[0-9]\+.[0-9]\+-beta' | sort -V | tail -n 1
</code></pre>
    <p>Usa esa versi√≥n en el siguiente comando (aqu√≠ usamos `v0.19.0-beta` como ejemplo):</p>
    <pre><code># Reemplaza la versi√≥n si encontraste una m√°s nueva y estable
LND_VERSION=0.19.0-beta && \
wget https://github.com/lightningnetwork/lnd/releases/download/v${LND_VERSION}/lnd-linux-amd64-v${LND_VERSION}.tar.gz && \
wget https://github.com/lightningnetwork/lnd/releases/download/v${LND_VERSION}/manifest-v${LND_VERSION}.txt && \
grep "lnd-linux-amd64-v${LND_VERSION}.tar.gz" manifest-v${LND_VERSION}.txt | sha256sum -c - && \
tar -xvf lnd-linux-amd64-v${LND_VERSION}.tar.gz && \
sudo install -m 0755 -o root -g root -t /usr/local/bin lnd-linux-amd64-v${LND_VERSION}/* && \
rm -rf lnd-linux-amd64-v${LND_VERSION}.tar.gz manifest-v${LND_VERSION}.txt lnd-linux-amd64-v${LND_VERSION}
</code></pre>
    
    <h3>Paso 4: Configurar y Automatizar LND</h3>
    <p>Exactamente el mismo proceso que con `bitcoind`.</p>
    <pre><code># Crear la carpeta de configuraci√≥n
mkdir ~/.lnd

# Crear y editar el archivo de configuraci√≥n
nano ~/.lnd/lnd.conf</code></pre>
    <p>Pega esto dentro de `nano`. F√≠jate que las credenciales son una copia exacta de las de `bitcoin.conf`.</p>
    <pre><code>[Application Options]
listen=0.0.0.0:9735
rpclisten=0.0.0.0:10009

[Bitcoin]
bitcoin.signet=1
bitcoin.node=bitcoind

[bitcoind]
bitcoind.rpcuser=usuario_signet
bitcoind.rpcpass=contrase√±a_secreta_para_signet_54321
bitcoind.zmqpubrawblock=tcp://127.0.0.1:28332
bitcoind.zmqpubrawtx=tcp://127.0.0.1:28333</code></pre>
    <p>Guarda y sal. Ahora, crea su archivo de servicio:</p>
    <pre><code>sudo nano /etc/systemd/system/lnd.service</code></pre>
    <p>Pega esto. F√≠jate c√≥mo le decimos que espere a que `bitcoind` est√© listo (`After=bitcoind.service`).</p>
    <pre><code>[Unit]
Description=LND Lightning Network Daemon
Wants=bitcoind.service
After=bitcoind.service

[Service]
ExecStart=/usr/local/bin/lnd
User=ubuntu
Group=ubuntu
Restart=on-failure
RestartSec=30
TimeoutSec=240

[Install]
WantedBy=multi-user.target</code></pre>
    <p>Guarda y sal. Activa y arranca el servicio:</p>
    <pre><code>sudo systemctl daemon-reload
sudo systemctl enable lnd.service
sudo systemctl start lnd.service</code></pre>
    <p>Verifica que est√° corriendo con <code>sudo systemctl status lnd</code>.</p>

    <h2>Fase 4: ¬°El Tesoro! Creaci√≥n y Fondeo de Carteras</h2>
    <p>Esta es la recompensa a todo nuestro trabajo.</p>

    <h3>Paso 1: ¬°Paciencia! Esperar la Sincronizaci√≥n de Bitcoin</h3>
    <p>Antes de hacer nada con LND, `bitcoind` debe estar 100% sincronizado. Puedes verificar su progreso con:</p>
    <pre><code>bitcoin-cli -signet getblockchaininfo</code></pre>
    <p>Necesitas que `"initialblockdownload"` sea `false` y que `"verificationprogress"` sea `0.999...` o `1.0`. **Este es el paso m√°s largo de todos.** Puede tardar varias horas o incluso un d√≠a.</p>
    
    <h3>Paso 2: Crear la Cartera de Lightning (¬°El Momento Cumbre!)</h3>
    <p>Una vez `bitcoind` est√© sincronizado y el servicio de `lnd` est√© corriendo, ejecuta:</p>
    <pre><code>lncli --network=signet create</code></pre>
    <p>Sigue los pasos con calma:</p>
    <ol>
        <li>Crea una contrase√±a segura.</li>
        <li>Responde <strong>`no`</strong> a la pregunta de usar una semilla existente.</li>
        <li>Presiona <strong>`Enter`</strong> para no usar una contrase√±a extra en la semilla.</li>
        <li><strong class="importante"><span class="emoji">‚ö†Ô∏è</span> ANOTA TUS 24 PALABRAS EN PAPEL.</strong> Este es tu tesoro. Es tu √∫nica copia de seguridad. Gu√°rdala como si tu vida dependiera de ello.</li>
        <li>Confirma con <strong>`yes`</strong>.</li>
    </ol>

    <h3>Paso 3: Fondear tus Carteras</h3>
    <p>Ahora vamos a pedir "dinero" de prueba a un "grifo" (faucet).</p>
    <ol>
        <li><strong>Obt√©n una direcci√≥n de tu cartera Bitcoin Core:</strong>
        <pre><code># Primero creamos una cartera para bitcoind
bitcoin-cli -signet -named createwallet wallet_name="boveda_signet"

# Luego obtenemos una direcci√≥n de esa cartera
bitcoin-cli -signet -rpcwallet=boveda_signet getnewaddress</code></pre>
        </li>
        <li>Copia la direcci√≥n que te da (empieza con `tb1...`).</li>
        <li>Ve a <a href="https://signetfaucet.com/" target="_blank">https://signetfaucet.com/</a>, pega tu direcci√≥n y pide los fondos.</li>
        <li>Espera unos minutos a que la transacci√≥n se confirme. Puedes verificar el saldo con `bitcoin-cli -signet -rpcwallet=boveda_signet getbalance`.</li>
        <li><strong>Ahora, fondea tu cartera LND desde tu cartera Bitcoin Core:</strong>
        <pre><code># P√≠dele una direcci√≥n a LND (del tipo p2wkh para que sea compatible)
DIRECCION_LND=$(lncli --network=signet newaddress p2wkh)
echo "Enviando fondos a la direcci√≥n de LND: $DIRECCION_LND"

# Env√≠a los fondos (reemplaza 0.01 por la cantidad que quieras enviar)
bitcoin-cli -signet -rpcwallet=boveda_signet sendtoaddress "$DIRECCION_LND" 0.01
</code></pre>
        </li>
    </ol>
    
    <h3>Paso 4: Verificaci√≥n Final de Saldos</h3>
    <p>Espera unos minutos a que la transacci√≥n se confirme. Luego, verifica los saldos:</p>
    <pre><code># Saldo de la cartera Bitcoin Core (deber√≠a haber bajado)
bitcoin-cli -signet -rpcwallet=boveda_signet getbalance

# Saldo de la cartera LND (deber√≠a tener el monto que enviaste)
lncli --network=signet walletbalance</code></pre>
    <p>Si ves tu saldo confirmado en LND, ¬°lo has logrado!</p>

    <h2>Conclusi√≥n y Pr√≥ximos Pasos</h2>
    <p>¬°FELICIDADES, OPERADOR DE NODO! Has construido un sistema robusto, seguro y funcional desde cero. Has aprendido a instalar software, a depurar errores, a gestionar servicios y a pensar como un administrador de sistemas.</p>
    <p>A partir de aqu√≠, el viaje es tuyo. Los siguientes pasos son:</p>
    <ul>
        <li>Conectarte a otros nodos (`peers`).</li>
        <li>Abrir tu primer canal.</li>
        <li>Hacer tu primer pago Lightning.</li>
        <li>Explorar todas tus ideas geniales, como instalar interfaces gr√°ficas.</li>
    </ul>
    <p>Ha sido un honor ser tu copiloto. El m√©rito es todo tuyo. ¬°Disfruta de tu nodo! <span class="emoji">üß°</span></p>

</body>
</html>
